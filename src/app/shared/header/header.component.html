<header>
    <img src="../../../assets/img/logo-with-font.png" alt="Logo Dabubble" class="logo">
    <div class="searchfield-container">
        <div class="searchfield-content">
            <input #search type="text" placeholder="Code learning durchsuchen" class="searchfield active"
                [ngClass]="{'active': isResults}" (click)="openResults()" (ngModelChange)="openResults()"
                appClickOutside (clickOutside)="closeResults()">
            <mat-icon class="search-icon" (click)="openResults()">search</mat-icon>




            <div *ngIf="isResults" class="result-container">
                <div class="result-channel-container">
                    <h4 class="n-h4">Channel</h4>
                    <div *ngFor="let channel of this.searchService.channelList; let i = index" (click)="openChannel()">
                        <div class="profile-content">
                            <div class="channels-section">
                                <div class="channels-header">
                                    <div class="channels-title">
                                        <mat-icon class="channel-icon">tag</mat-icon>
                                        <p class="n-p">{{ channel.channelName }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="result-dm-container">
                    <h4 class="n-h4">Direktnachrichten</h4>
                    <div *ngFor="let dm of this.searchService.directMessage; let i = index" (click)="openDM()">
                        <div class="profile-content dm-content">
                            <div class="profile-left">
                                <div class="profile">
                                    <img [src]="dm.profileImg" alt="Character" class="profile-icon">
                                    <div class="result-status-icon" [ngClass]="dm.profileState"></div>
                                </div>
                                <p class="n-p">
                                    {{ dm.profileName }}
                                    <span *ngIf="dm.profileName === this.currentUser.username">(Du)</span>
                                </p>
                            </div>
                            <div class="profile-right">
                                <div class="profile-up">
                                    <mat-divider> </mat-divider>
                                    <div class="message-date">
                                        {{ chatService.formatDate(dm.date) }}
                                    </div>
                                </div>
                                <div class="profile-down">
                                    <!--  -->
                                    <div class="my-message">
                                        <div class="message-wrapper">
                                            <div class="profile-img">
                                                <img class="user-img" src="{{ dm.authorImg }}" />
                                                <div class="result-status-icon" [ngClass]="dm.authorstate"></div>
                                            </div>

    
                                            <div class="message-details">
                                                <div class="user-wrapper">
                                                    <div class="user-name">{{ dm.authorName }}</div>
                                                    <div class="time">
                                                        {{ chatService.formatTime(dm.time) }} Uhr
                                                    </div>
                                                </div>
                                                <div class="text-bubble">
                                                    <ng-container
                                                        *ngIf="directMessageService.isImage(dm.text); else textContent">
                                                        <img [src]="dm.text" alt="Image" class="message-image" />
                                                    </ng-container>
                                                    <ng-template #textContent>{{ dm.text }}</ng-template>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!--  -->
                                </div>
                            </div>


                        </div>
                    </div>
                </div>


                <div class="result-user-container">
                    <h4 class="n-h4">User</h4>
                    <div *ngFor="let user of this.searchService.userList; let i = index" (click)="openProfile()">
                        <div class="profile-content">
                            <div class="profile">
                                <img [src]="user.profileImage" alt="Character" class="profile-icon">
                                <div class="result-status-icon online" [ngClass]="user.state"></div>
                            </div>
                            <p class="n-p">
                                {{ user.username }}
                                <span *ngIf="user.username === this.currentUser.username">(Du)</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>







        </div>




    </div>
    <div class="user-div">
        <div class="user-container" (click)="openPopup($event)">
            <div class="user-name">{{ currentUser?.username }}</div>
            <div class="img-content">
                <img src="{{ currentUser?.profileImage }}" alt="User">
                <div class="status-icon" ngClass="{{ currentUser?.state }}"></div>
            </div>
            <div>
                <mat-icon class="arrow-icon">keyboard_arrow_down</mat-icon>
            </div>
        </div>
        <div class="info-container" *ngIf="clickedUser" appClickOutside (clickOutside)="closePopup()">
            <a (click)="openProfile()">Profil</a>
            <a (click)="logOut($event)">Log out</a>
        </div>
    </div>
</header>
<app-my-profile *ngIf="clickedProfile" [clickedProfile]="clickedProfile"
    (clickedProfileChange)="profileClosed()"></app-my-profile>